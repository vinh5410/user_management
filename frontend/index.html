<!DOCTYPE html> 
<html lang="vi"> 
<head> 
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<title>Quản lý Người dùng</title> 
<!-- React CDN --> 
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script> 
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script> 
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script> 
<style> 
/* TODO: Thêm CSS */
* { 

margin: 0; 
padding: 0; 
box-sizing: border-box; 
} 
body { 
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
padding: 20px; 
background: #f5f5f5; 
} 
.container { 
max-width: 1200px; 
margin: 0 auto; 
background: white; 
padding: 30px; 
border-radius: 8px; 
box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
} 
h1 { 
margin-bottom: 20px; 
color: #333; 
} 
/* Search Bar */ 
.search-bar { 
margin-bottom: 15px; 
} 
.search-bar input { 
width: 100%; 

padding: 12px; 
font-size: 16px; 
border: 2px solid #ddd; 
border-radius: 4px; 
} 
/* Table */ 
table { 
width: 100%; 
border-collapse: collapse; 
margin: 20px 0; 
} 
th, td { 
padding: 12px; 
text-align: left; 
border: 1px solid #ddd; 
} 
th { 
background: #4CAF50; 
color: white; 
font-weight: bold; 
} 
tr:nth-child(even) { 
background: #f9f9f9; 
} 
tr:hover { 
background: #f5f5f5; 
} 
/* Buttons */ 
button { 
padding: 8px 16px; 
margin: 0 4px; 
border: none; 
border-radius: 4px; 
cursor: pointer; 
font-size: 14px; 
} 
/* Modal */ 
.modal-overlay { 
position: fixed; 
top: 0; 
left: 0; 
width: 100%; 
} 
</style> 
</head> 
<body> 
<div id="root"></div> 
<script type="text/babel"> 
    const { useState, useEffect } = React;
    function SearchBar({ value, onChange }) { 
    return ( 
    <div className="search-bar"> 
    <input 
    type="text" 
    placeholder="Tìm theo tên, email, địa chỉ..." 
    value={value} 
    onChange={(e) => onChange(e.target.value)} 
    style={{ width: '100%', padding: '10px', fontSize: '16px' }} 
    /> 
    </div> 
    ); 
    }    
    function UserTable({ users, onEdit, onDelete,page,limit }) { 
    const handleDelete = (id, name) => { 
    if (window.confirm(`Bạn có chắc muốn xóa "${name}"?`)) { 
    onDelete(id); 
    } 
    }; 
    return ( 
    <table> 
    <thead> 
    <tr> 
    <th>STT</th> 
    <th>Họ tên</th> 
    <th>Tuổi</th> 
    <th>Email</th> 
    <th>Địa chỉ</th> 
    <th>Thao tác</th> 
    </tr> 
    </thead> 
    <tbody> 
    {users.length === 0 ? ( 
    <tr> 
    <td colSpan="6" style={{ textAlign: 'center' }}> 
    Không có dữ liệu 
    </td> 
    </tr> 
    ) : ( 
    users.map((user, index) => ( 
    <tr key={user._id}> 
    <td>{(page-1)*limit + index + 1}</td>
    <td>{user.name}</td> 
    <td>{user.age}</td> 
    <td>{user.email}</td> 
    <td>{user.address || "-"}</td>
    <td> 
    <button onClick={() => onEdit(user)}> Sửa</button> 
    <button onClick={() => handleDelete(user._id, user.name)}>Xóa 
    </button> 
    </td> 
    </tr> 
    )) 
    )} 
    </tbody> 
    </table> 
    ); 
    }    
    function Pagination({ page, totalPages, limit, onPageChange, onLimitChange }) { 
        const [inputLimit, setInputLimit] = React.useState(limit);
        const handleLimitChange = (e) => {
        const value = e.target.value;
        setInputLimit(value);
        };
        const handleLimitBlur = () => {
        let newLimit = parseInt(inputLimit);
        //validate
        if (isNaN(newLimit) || newLimit <= 0) {
        newLimit = 5; //default
        }
        if (newLimit>10) {
            newLimit=10; //max 10
        }
        setInputLimit(newLimit);
        onLimitChange(newLimit);
    };
        const handleKeyPress = (e) => {
        if (e.key === 'Enter') {
        handleLimitBlur();
        }
        };
    return ( 
    <div className="pagination"> 
    <div> 
        Hiển thị: 
        <input 
          type="number"
          value={inputLimit}
          onChange={handleLimitChange}
          onBlur={handleLimitBlur}
          onKeyPress={handleKeyPress}
          min="1"
          max="10"
          style={{
            width: '60px',
            padding: '5px',
            marginLeft: '5px',
            marginRight: '5px',
            border: '1px solid #ddd',
            borderRadius: '4px',
            textAlign: 'center'
          }}
        />
    dòng/trang 
    </div> 
    <div> 
    <button  
    onClick={() => onPageChange(page - 1)}  
    disabled={page === 1} 
    > 
    Prev 
    </button> 
    <span style={{ margin: '0 15px' }}> 
    Trang {page}/{totalPages || 1} 
    </span> 
    <button  
    onClick={() => onPageChange(page + 1)}  
    disabled={page >= totalPages} 
    > 
    Next  
    </button> 
    </div> 
    </div> 
    ); 
    }
    function UserModal({ user, onClose, onSave }) { 
    const [formData, setFormData] = React.useState( 
    user || { name: "", age: "", email: "", address: "" } 
    ); 
    const [errors, setErrors] = React.useState({}); 
    const handleChange = (e) => { 
    setFormData({ ...formData, [e.target.name]: e.target.value }); 
    }; 
    const validate = () => { 
    const newErrors = {}; 
    const trimmedName = formData.name.trim();
    if(!trimmedName||trimmedName.length<2)
    {
    newErrors.name="Tên phải có ít nhất 2 ký tự";
    }
    if (!formData.age || formData.age < 0) { 
    newErrors.age = "Tuổi phải >= 0"; 
    } 
    const trimmedEmail = formData.email.trim();
    if (!trimmedEmail || !trimmedEmail.includes("@") || 
    !trimmedEmail.includes(".")) { 
    newErrors.email = "Email không hợp lệ"; 
    } 
    setErrors(newErrors); 
    22 
    return Object.keys(newErrors).length === 0; 
    }; 
    const handleSubmit = () => { 
    if (!validate()) return; 
    const normalizedData = {
    name: formData.name.trim().replace(/\s+/g, ' '),
    age: parseInt(formData.age),
    email: formData.email.trim().toLowerCase(),
    address: formData.address.trim()
    };
    const url = user 
    ? `http://localhost:3001/api/users/${user._id}` 
    : `http://localhost:3001/api/users`; 
    const method = user ? "PUT" : "POST"; 
    fetch(url, { 
    method, 
    headers: { "Content-Type": "application/json" }, 
    body: JSON.stringify(formData) 
    }) 
    .then(res => res.json()) 
    .then(data => { 
    if (data.error) { 
    alert("Lỗi: " + data.error); 
    } else { 
    alert(data.message); 
    onSave(); // Gọi lại fetchUsers() và đóng modal 
    } 
    }) 
    .catch(err => alert("Lỗi: " + err.message)); 
    }; 
    return ( 
    <div className="modal-overlay" onClick={onClose}> 
    <div className="modal-content" onClick={(e) => e.stopPropagation()}> 
    <h3>{user ? "Sửa người dùng" : "Thêm người dùng"}</h3> 
    <label>Họ tên *</label> 
    <input 
    name="name" 
    value={formData.name} 
    onChange={handleChange} 
    /> 
    {errors.name && <p className="error">{errors.name}</p>} 
    <label>Tuổi *</label> 
    <input 
    name="age" 
    type="number" 
    value={formData.age} 
    onChange={handleChange} 
    /> 
    {errors.age && <p className="error">{errors.age}</p>} 
    <label>Email *</label> 
    <input 
    name="email" 
    type="email" 
    value={formData.email} 
    onChange={handleChange} 
    /> 
    {errors.email && <p className="error">{errors.email}</p>} 
    <label>Địa chỉ</label> 
    <input 
    name="address" 
    value={formData.address} 
    onChange={handleChange} 
    /> 
    <div className="modal-actions"> 
    <button onClick={handleSubmit}>Lưu</button> 
    <button onClick={onClose}>Hủy</button> 
    </div> 
    </div> 
    </div> 
    ); 
    } 
    function App() { 
    // States 
    const [users, setUsers] = React.useState([]); 
    const [page, setPage] = React.useState(1); 
    const [limit, setLimit] = React.useState(5); 
    const [search, setSearch] = React.useState(""); 
    const [total, setTotal] = React.useState(0); 
    const [totalPages, setTotalPages] = React.useState(0); 
    const [showModal, setShowModal] = React.useState(false); 
    const [editingUser, setEditingUser] = React.useState(null); 
    // Fetch users 
    const fetchUsers = () => { 
    const url = 
    `http://localhost:3001/api/users?page=${page}&limit=${limit}&search=${search}`; 
    fetch(url) 
    .then(res => res.json()) 
    .then(data => {  
    setUsers(data.data); 
    setTotal(data.total); 
    setTotalPages(data.totalPages); 
    }) 
    .catch(err => console.error("Fetch error:", err)); 
    }; 
    const deleteUser = (id) => { 
    fetch(`http://localhost:3001/api/users/${id}`, { 
    method: "DELETE" 
    }) 
    .then(res => res.json()) 
    .then(data => { 
    alert(data.message); 
    fetchUsers(); // Phải gọi lại để cập nhật UI 
    }) 
    .catch(err => alert("Lỗi: " + err.message)); 
    };    
    // useEffect: Gọi API khi page, limit, search thay đổi 
    React.useEffect(() => { 
    fetchUsers(); 
    }, [page, limit, search]); 
    return ( 
    <div className="container"> 
    <h1>Quản lý Người dùng</h1> 
    <SearchBar value={search} onChange={setSearch} /> 
    <button onClick={() => { setEditingUser(null); setShowModal(true); }}> 
    Thêm người dùng 
    </button> 
    <UserTable 
    users={users}
    page={page}
    limit={limit}
    onEdit={(user) => { setEditingUser(user); setShowModal(true); }} 
    onDelete={(id) => deleteUser(id)} 
    /> 
    <Pagination 
    page={page} 
    totalPages={totalPages} 
    limit={limit}  
    onPageChange={setPage} 
    onLimitChange={(newLimit) => {
    setLimit(newLimit);
    setPage(1); // Reset về trang 1 khi đổi limit
    }} 
    /> 
    {showModal && ( 
    <UserModal 
    user={editingUser} 
    onClose={() => setShowModal(false)} 
    onSave={() => { fetchUsers(); setShowModal(false); }} 
    /> 
    )} 
    </div> 
    ); 
    }
    const root = ReactDOM.createRoot(document.getElementById("root")); 
    root.render(<App />);      
</script> 
</body> 
</html>